<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Revenue & CAC Simulator - EdTech Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
        }
        
        .funnel-step {
            transition: all 0.3s ease;
        }
        
        /* Glassmorphism for panels */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Navbar -->
    <nav class="bg-blue-900 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-chart-line text-2xl text-blue-400"></i>
                <div>
                    <h1 class="font-bold text-xl tracking-tight">CRO Command Center</h1>
                    <p class="text-xs text-blue-200 uppercase tracking-widest">SaaS EdTech Simulator</p>
                </div>
            </div>
            <button onclick="resetDefaults()" class="text-sm bg-blue-700 hover:bg-blue-600 px-3 py-1 rounded transition">
                <i class="fa-solid fa-rotate-right mr-1"></i> Reset Benchmark
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- LEFT COLUMN: CONTROLS & INPUTS -->
        <div class="lg:col-span-4 space-y-6 overflow-y-auto h-screen pb-20 no-scrollbar">
            
            <!-- 1. Volume & Efficiency Inputs -->
            <div class="glass-panel rounded-xl p-6">
                <h2 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                    <i class="fa-solid fa-filter mr-2 text-blue-600"></i> Métricas del Funnel
                </h2>

                <!-- Leads Input -->
                <div class="mb-5">
                    <label class="flex justify-between text-sm font-semibold text-gray-600 mb-1">
                        <span>Leads Totales (Mkt)</span>
                        <span class="text-blue-600" id="val-leads">1000</span>
                    </label>
                    <input type="range" min="100" max="10000" step="50" value="1000" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb" id="input-leads" oninput="updateSim()">
                </div>

                <!-- Conversion Sliders -->
                <div class="space-y-5 border-l-2 border-blue-100 pl-4">
                    
                    <!-- Lead to MQL -->
                    <div>
                        <label class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                            <span>Lead -> MQL (Cualificación)</span>
                            <span class="text-blue-600" id="val-cr-mql">20%</span>
                        </label>
                        <input type="range" min="1" max="100" value="20" class="w-full h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer" id="input-cr-mql" oninput="updateSim()">
                    </div>

                    <!-- MQL to SQL (Meetings) -->
                    <div>
                        <label class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                            <span>MQL -> Reunión/SQL (SDR)</span>
                            <span class="text-blue-600" id="val-cr-sql">15%</span>
                        </label>
                        <input type="range" min="1" max="100" value="15" class="w-full h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer" id="input-cr-sql" oninput="updateSim()">
                    </div>

                    <!-- SQL to Proposal -->
                    <div>
                        <label class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                            <span>SQL -> Propuesta (Pipeline)</span>
                            <span class="text-blue-600" id="val-cr-prop">60%</span>
                        </label>
                        <input type="range" min="1" max="100" value="60" class="w-full h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer" id="input-cr-prop" oninput="updateSim()">
                    </div>

                    <!-- Win Rate -->
                    <div>
                        <label class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                            <span>Win Rate (Cierre)</span>
                            <span class="text-blue-600" id="val-cr-win">25%</span>
                        </label>
                        <input type="range" min="1" max="100" value="25" class="w-full h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer" id="input-cr-win" oninput="updateSim()">
                    </div>
                </div>

                <!-- Deal Size -->
                <div class="mt-6 pt-4 border-t border-gray-100">
                    <label class="flex justify-between text-sm font-semibold text-gray-600 mb-1">
                        <span>ACV (Ticket Promedio Anual)</span>
                        <span class="text-green-600" id="val-acv">€15,000</span>
                    </label>
                    <input type="range" min="1000" max="100000" step="1000" value="15000" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb" id="input-acv" oninput="updateSim()">
                </div>
            </div>

            <!-- 2. Cost Structure (CAC Inputs) -->
            <div class="glass-panel rounded-xl p-6">
                <h2 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                    <i class="fa-solid fa-wallet mr-2 text-red-500"></i> Estructura de Costes (Mes)
                </h2>
                
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="text-xs text-gray-500 block mb-1">Inversión Marketing (Ads/Eventos)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-400">€</span>
                            <input type="number" id="cost-marketing" value="5000" class="w-full pl-8 pr-3 py-2 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="updateSim()">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 block mb-1">Equipo Ventas (Salarios SDR+AE)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-400">€</span>
                            <input type="number" id="cost-sales" value="12000" class="w-full pl-8 pr-3 py-2 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="updateSim()">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 block mb-1">Tech Stack & Ops (CRM/Tools)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-400">€</span>
                            <input type="number" id="cost-tech" value="2000" class="w-full pl-8 pr-3 py-2 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="updateSim()">
                        </div>
                    </div>
                </div>
                <div class="mt-3 text-right">
                    <p class="text-xs text-gray-400">Total Burn Mensual: <span id="total-burn" class="font-bold text-gray-600">€19,000</span></p>
                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN: VISUALIZATION & KPI -->
        <div class="lg:col-span-8 space-y-6">

            <!-- Top Level KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Revenue Card -->
                <div class="bg-white rounded-xl p-5 shadow-md border-l-4 border-green-500">
                    <p class="text-gray-400 text-xs font-bold uppercase">New Revenue (MRR Est.)</p>
                    <h3 class="text-3xl font-bold text-gray-800 mt-1" id="kpi-revenue">€0</h3>
                    <p class="text-xs text-green-600 mt-2 font-medium"><i class="fa-solid fa-arrow-trend-up"></i> Proyección Mensual</p>
                </div>

                <!-- Deals Card -->
                <div class="bg-white rounded-xl p-5 shadow-md border-l-4 border-blue-500">
                    <p class="text-gray-400 text-xs font-bold uppercase">Deals Cerrados</p>
                    <h3 class="text-3xl font-bold text-gray-800 mt-1" id="kpi-deals">0</h3>
                    <p class="text-xs text-blue-600 mt-2 font-medium" id="kpi-deal-velocity">Ciclo completo</p>
                </div>

                <!-- CAC Card -->
                <div class="bg-white rounded-xl p-5 shadow-md border-l-4 border-red-500 relative overflow-hidden">
                    <p class="text-gray-400 text-xs font-bold uppercase">CAC Implícito</p>
                    <h3 class="text-3xl font-bold text-gray-800 mt-1" id="kpi-cac">€0</h3>
                    <div class="flex items-center mt-2 gap-2">
                        <span id="cac-status-badge" class="px-2 py-0.5 rounded text-[10px] font-bold bg-gray-100 text-gray-500">N/A</span>
                        <p class="text-xs text-gray-500">Ratio LTV:CAC <span id="kpi-ltv-cac" class="font-bold">0x</span></p>
                    </div>
                </div>
            </div>

            <!-- The Visual Funnel -->
            <div class="glass-panel rounded-xl p-8 relative min-h-[500px]">
                <h3 class="text-gray-700 font-bold mb-6 text-center">Visualización del Pipeline</h3>
                
                <div class="flex flex-col items-center justify-center space-y-2 w-full max-w-2xl mx-auto">
                    
                    <!-- Stage 1: Leads -->
                    <div class="w-full relative group">
                        <div class="bg-gray-200 h-12 rounded flex items-center justify-between px-4 text-gray-700 font-bold shadow-sm funnel-step" style="width: 100%">
                            <span>Leads</span>
                            <span id="view-leads">1000</span>
                        </div>
                        <!-- Connector -->
                        <div class="h-6 w-0.5 bg-gray-300 mx-auto"></div>
                    </div>

                    <!-- Stage 2: MQL -->
                    <div class="w-full relative group flex justify-center">
                        <div id="bar-mql" class="bg-blue-200 h-12 rounded flex items-center justify-between px-4 text-blue-900 font-bold shadow-sm funnel-step" style="width: 80%">
                            <span>MQLs</span>
                            <span id="view-mql">200</span>
                        </div>
                    </div>
                    <!-- Connector -->
                    <div class="h-6 w-0.5 bg-blue-200 mx-auto"></div>

                    <!-- Stage 3: SQL/Meetings (The Pivot Point) -->
                    <div class="w-full relative group flex justify-center">
                        <div id="bar-sql" class="bg-blue-400 h-14 rounded flex items-center justify-between px-4 text-white font-bold shadow-md transform hover:scale-105 transition funnel-step" style="width: 60%">
                            <span><i class="fa-regular fa-calendar-check mr-2"></i>Reuniones (SQL)</span>
                            <span id="view-sql">30</span>
                        </div>
                    </div>
                    <!-- Connector -->
                    <div class="h-6 w-0.5 bg-blue-400 mx-auto"></div>

                    <!-- Stage 4: Proposals -->
                    <div class="w-full relative group flex justify-center">
                        <div id="bar-prop" class="bg-indigo-500 h-12 rounded flex items-center justify-between px-4 text-white font-bold shadow-sm funnel-step" style="width: 40%">
                            <span>Propuestas</span>
                            <span id="view-prop">18</span>
                        </div>
                    </div>
                    <!-- Connector -->
                    <div class="h-6 w-0.5 bg-indigo-500 mx-auto"></div>

                    <!-- Stage 5: Won -->
                    <div class="w-full relative group flex justify-center">
                        <div id="bar-won" class="bg-green-500 h-16 rounded flex items-center justify-between px-4 text-white font-bold shadow-lg border border-green-400 funnel-step" style="width: 20%">
                            <span><i class="fa-solid fa-trophy mr-2"></i>Deals Cerrados</span>
                            <span id="view-won">4.5</span>
                        </div>
                    </div>

                </div>

                <!-- Insights Overlay -->
                <div class="mt-8 grid grid-cols-2 gap-4 text-sm bg-white p-4 rounded-lg border border-gray-100">
                    <div>
                        <span class="block text-gray-400 text-xs uppercase font-bold">Eficiencia Global</span>
                        <span id="global-conversion" class="text-gray-800 font-bold">0.45%</span> <span class="text-xs text-gray-500">(Lead a Cliente)</span>
                    </div>
                    <div>
                        <span class="block text-gray-400 text-xs uppercase font-bold">Coste por Oportunidad</span>
                        <span id="cpo-metric" class="text-gray-800 font-bold">€0</span> <span class="text-xs text-gray-500">(por Propuesta enviada)</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Formatting Utilities
        const formatCurrency = (num) => {
            return new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(num);
        };
        
        const formatNumber = (num) => {
            return new Intl.NumberFormat('es-ES', { maximumFractionDigits: 1 }).format(num);
        };

        function resetDefaults() {
            document.getElementById('input-leads').value = 1000;
            document.getElementById('input-cr-mql').value = 20;
            document.getElementById('input-cr-sql').value = 15;
            document.getElementById('input-cr-prop').value = 60;
            document.getElementById('input-cr-win').value = 25;
            document.getElementById('input-acv').value = 15000;
            
            document.getElementById('cost-marketing').value = 5000;
            document.getElementById('cost-sales').value = 12000;
            document.getElementById('cost-tech').value = 2000;
            
            updateSim();
        }

        function updateSim() {
            // 1. Get Inputs
            const leads = parseInt(document.getElementById('input-leads').value);
            const crMql = parseInt(document.getElementById('input-cr-mql').value) / 100;
            const crSql = parseInt(document.getElementById('input-cr-sql').value) / 100;
            const crProp = parseInt(document.getElementById('input-cr-prop').value) / 100;
            const crWin = parseInt(document.getElementById('input-cr-win').value) / 100;
            const acv = parseInt(document.getElementById('input-acv').value);

            const costMkt = parseInt(document.getElementById('cost-marketing').value) || 0;
            const costSales = parseInt(document.getElementById('cost-sales').value) || 0;
            const costTech = parseInt(document.getElementById('cost-tech').value) || 0;
            const totalBurn = costMkt + costSales + costTech;

            // 2. Update Input Labels
            document.getElementById('val-leads').innerText = formatNumber(leads);
            document.getElementById('val-cr-mql').innerText = (crMql * 100).toFixed(0) + '%';
            document.getElementById('val-cr-sql').innerText = (crSql * 100).toFixed(0) + '%';
            document.getElementById('val-cr-prop').innerText = (crProp * 100).toFixed(0) + '%';
            document.getElementById('val-cr-win').innerText = (crWin * 100).toFixed(0) + '%';
            document.getElementById('val-acv').innerText = formatCurrency(acv);
            document.getElementById('total-burn').innerText = formatCurrency(totalBurn);

            // 3. Calculate Funnel Flow
            const mqls = leads * crMql;
            const sqls = mqls * crSql; // Meetings
            const proposals = sqls * crProp;
            const deals = proposals * crWin;
            const revenue = deals * acv;

            // 4. Calculate Financials
            let cac = 0;
            let ltvCac = 0;
            let cpo = 0; // Cost per Opportunity (Proposal)

            if (deals > 0) {
                cac = totalBurn / deals;
                ltvCac = acv / cac; // Assuming LTV = ACV (1 year) for simplicity, or modify logic
            }
            
            if (proposals > 0) {
                cpo = totalBurn / proposals;
            }

            const conversionGlobal = (deals / leads) * 100;

            // 5. Update UI Outputs (KPIs)
            document.getElementById('kpi-revenue').innerText = formatCurrency(revenue);
            document.getElementById('kpi-deals').innerText = formatNumber(deals);
            document.getElementById('kpi-cac').innerText = formatCurrency(cac);
            
            // LTV:CAC Logic for Badge
            const ltvBadge = document.getElementById('cac-status-badge');
            const ltvText = document.getElementById('kpi-ltv-cac');
            ltvText.innerText = ltvCac.toFixed(1) + 'x';

            if(ltvCac >= 3) {
                ltvBadge.className = "px-2 py-0.5 rounded text-[10px] font-bold bg-green-100 text-green-700";
                ltvBadge.innerText = "SALUDABLE";
            } else if (ltvCac >= 1) {
                ltvBadge.className = "px-2 py-0.5 rounded text-[10px] font-bold bg-yellow-100 text-yellow-700";
                ltvBadge.innerText = "RIESGO";
            } else {
                ltvBadge.className = "px-2 py-0.5 rounded text-[10px] font-bold bg-red-100 text-red-700";
                ltvBadge.innerText = "INSORTENIBLE";
            }

            document.getElementById('global-conversion').innerText = conversionGlobal.toFixed(2) + '%';
            document.getElementById('cpo-metric').innerText = formatCurrency(cpo);

            // 6. Update Visual Funnel Bars (Dynamic Widths)
            // Logic: Width is relative to the previous step to show "drop off", but clamped so it doesn't disappear
            document.getElementById('view-leads').innerText = formatNumber(leads);
            
            document.getElementById('view-mql').innerText = formatNumber(mqls);
            // Visual width logic: Relative to total leads, but min 20% for visibility
            let widthMql = (mqls / leads) * 100;
            document.getElementById('bar-mql').style.width = Math.max(widthMql, 20) + '%';

            document.getElementById('view-sql').innerText = formatNumber(sqls);
            let widthSql = (sqls / leads) * 100;
            document.getElementById('bar-sql').style.width = Math.max(widthSql, 15) + '%';

            document.getElementById('view-prop').innerText = formatNumber(proposals);
            let widthProp = (proposals / leads) * 100;
            document.getElementById('bar-prop').style.width = Math.max(widthProp, 10) + '%';

            document.getElementById('view-won').innerText = formatNumber(deals);
            let widthWon = (deals / leads) * 100;
            document.getElementById('bar-won').style.width = Math.max(widthWon, 8) + '%';
        }

        // Initialize
        updateSim();

    </script>
</body>
</html>